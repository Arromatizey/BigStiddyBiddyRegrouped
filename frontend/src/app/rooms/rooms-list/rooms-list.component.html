<div class="rooms-container">
  <header class="rooms-header">
    <h1>Salles d'√©tude</h1>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="openCreateRoomDialog()">
        Cr√©er une salle
      </button>
      <button class="btn btn-secondary" (click)="testBackendConnectivity()" style="margin-right: 10px;">
        üîç Test Backend
      </button>
      <button class="btn btn-secondary" (click)="testRoomCreation()" style="margin-right: 10px;">
        üß™ Test Room Creation
      </button>
      <button class="btn btn-secondary" (click)="logout()">
        D√©connexion
      </button>
    </div>
  </header>

  <div class="loading" *ngIf="loading">
    <p>Chargement des salles...</p>
  </div>

  <div class="rooms-grid" *ngIf="!loading">
    <div class="room-card" *ngFor="let room of rooms">
      <div class="room-info">
        <h3>{{ room.subject }}</h3>
        <p><strong>Niveau:</strong> {{ room.level }}</p>
        <p><strong>Sujet:</strong> {{ room.topic }}</p>
        <p><strong>Focus:</strong> {{ room.focusDuration }} min</p>
        <p><strong>Pause:</strong> {{ room.breakDuration }} min</p>
        <div class="room-status">
          <span class="status" [class.active]="room.isActive">
            {{ room.isActive ? 'Active' : 'Inactive' }}
          </span>
          <span class="timer-status" *ngIf="room.timerRunning">
            {{ room.isOnBreak ? 'En pause' : 'Focus en cours' }}
          </span>
        </div>
      </div>
      <div class="room-actions">
        <button class="btn btn-primary" (click)="joinRoom(room.id!)">
          Rejoindre la salle
        </button>
      </div>
    </div>

    <div class="empty-state" *ngIf="rooms.length === 0">
      <p>Aucune salle disponible. Cr√©ez votre premi√®re salle d'√©tude !</p>
    </div>
  </div>

  <!-- Create Room Dialog (inline) -->
  <div class="dialog-overlay" *ngIf="showCreateDialog" (click)="hideCreateDialog()">
    <div class="dialog-content" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <h2>Cr√©er une nouvelle salle d'√©tude</h2>
        <button class="close-btn" (click)="hideCreateDialog()">&times;</button>
      </div>
      
      <form [formGroup]="createRoomForm" (ngSubmit)="onCreateRoom()">
        <div class="form-grid">
          <div class="form-group">
            <label for="subject">Mati√®re *</label>
            <input 
              type="text" 
              id="subject" 
              formControlName="subject" 
              class="form-control"
              placeholder="Ex: Math√©matiques">
          </div>

          <div class="form-group">
            <label for="level">Niveau *</label>
            <select 
              id="level" 
              formControlName="level" 
              class="form-control">
              <option value="">S√©lectionner un niveau</option>
              <option value="D√©butant">D√©butant</option>
              <option value="Interm√©diaire">Interm√©diaire</option>
              <option value="Avanc√©">Avanc√©</option>
            </select>
          </div>

          <div class="form-group">
            <label for="topic">Sujet</label>
            <input 
              type="text" 
              id="topic" 
              formControlName="topic" 
              class="form-control"
              placeholder="Ex: Calcul diff√©rentiel">
          </div>

          <div class="form-group">
            <label for="institution">Institution</label>
            <input 
              type="text" 
              id="institution" 
              formControlName="institution" 
              class="form-control"
              placeholder="Ex: Universit√© Paris">
          </div>

          <div class="form-group">
            <label for="focusDuration">Dur√©e focus (min) *</label>
            <input 
              type="number" 
              id="focusDuration" 
              formControlName="focusDuration" 
              class="form-control"
              min="1"
              max="120">
          </div>

          <div class="form-group">
            <label for="breakDuration">Dur√©e pause (min) *</label>
            <input 
              type="number" 
              id="breakDuration" 
              formControlName="breakDuration" 
              class="form-control"
              min="1"
              max="60">
          </div>
        </div>

        <div class="dialog-actions">
          <button type="button" class="btn btn-secondary" (click)="hideCreateDialog()">
            Annuler
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="createRoomForm.invalid">
            Cr√©er la salle
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
